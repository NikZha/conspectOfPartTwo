<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>События указателя</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>

<body>
    <div class="contents">
        <h2><a href="#events">События указателя</a></h2>
        <ul>
            <li><a href="#short">Краткая история</a></li>
            <li><a href="#type">Типы событий указателя</a></li>
            <li><a href="#prop">Свойства событий указателя</a></li>
            <li><a href="#multitach">Мульти-тач</a></li>
            <li><a href="#pointercancel">Событие: pointercancel</a></li>
            <li><a href="#catch">Захват указателя</a></li>
            <li><a href="#total">Итого</a></li>
        </ul>
    </div>
    <div class="topic" id="events">
        <h2><a href="https://learn.javascript.ru/pointer-events">События указателя</a></h2>
        <p>События указателя (Pointer events) – это современный способ обработки ввода с помощью различных указывающих
            устройств, таких как мышь, перо/стилус, сенсорный экран и так далее.</p>
    </div>
    <div class="topic" id="short">
        <h3>Краткая история</h3>
        <p>Если вы не разрабатываете под старые браузеры, такие как Internet Explorer 10, Safari 12, или более ранние
            версии, больше нет необходимости использовать события мыши или касаний – можно переходить сразу на события
            указателя.</p>
    </div>
    <div class="topic" id="type">
        <h3>Типы событий указателя</h3>
        <table>
            <thead>
                <tr>
                    <th>Событие указателя</th>
                    <th>Аналогичное событие мыши</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>pointerdown </td>
                    <td>mousedown</td>
                </tr>
                <tr>
                    <td>pointerup</td>
                    <td>mouseup</td>
                </tr>
                <tr>
                    <td>pointermove</td>
                    <td>mousemove</td>
                </tr>
                <tr>
                    <td>pointerover</td>
                    <td>mouseover</td>
                </tr>
                <tr>
                    <td>pointerout</td>
                    <td>mouseout</td>
                </tr>
                <tr>
                    <td>pointerenter</td>
                    <td>mouseenter</td>
                </tr>
                <tr>
                    <td>pointerleave</td>
                    <td>mouseleave</td>
                </tr>
                <tr>
                    <td>pointercancel</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>gotpointercapture</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>lostpointercapture</td>
                    <td>-</td>
                </tr>
            </tbody>
        </table>
        <p>Аналогичные события играют те же самые роли. Можно даже заменить mouse... на pointer... и код будер работать
            аналогичным образом.</p>
    </div>
    <div class="topic" id="prop">
        <h3>Свойства событий указателя</h3>
        <p>Есть дополнительные события указателя:</p>
        <ul>
            <li>pointerId – уникальный идентификатор указателя, вызвавшего событие.

                <br>Идентификатор генерируется браузером. Это свойство позволяет обрабатывать несколько указателей,
                например сенсорный экран со стилусом и мульти-тач (увидим примеры ниже).
            </li>

            <li>pointerType – тип указывающего устройства. Должен быть строкой с одним из значений: «mouse», «pen» или
                «touch».

                <br>Мы можем использовать это свойство, чтобы определять разное поведение для разных типов указателей.
            </li>

            <li>isPrimary – равно true для основного указателя (первый палец в мульти-тач). </li>
        </ul>
        <p>У некоторых устройств есть дополнительные свойства:</p>
        <ul>
            <li>width – ширина области соприкосновения указателя (например, пальца) с устройством. Если не
                поддерживается, например мышью, то всегда равно 1.</li>
            <li>height – высота области соприкосновения указателя с устройством. Если не поддерживается, например мышью,
                то всегда равно 1.</li>
            <li>pressure – степень давления указателя в диапазоне от 0 до 1. Для устройств, которые не поддерживают
                давление, принимает значение 0.5 (нажато) либо 0.</li>
            <li>tangentialPressure – нормализованное тангенциальное давление.</li>
            <li>tiltX, tiltY, twist – специфичные для пера свойства, описывающие положение пера относительно сенсорной
                поверхности. </li>
        </ul>
        <p>Но большинство устройств не поддерживает эти свойства.</p>
    </div>
    <div class="topic" id="multitach">
        <h3>Мульти-тач</h3>
        <p>Что происходти:</p>
        <ul>
            <li>При касании первым пальцем:
                <br>происходит событие pointerdown со свойством <code>isPrimary=true</code> и некоторым
                <code>pointerId</code>.
            </li>
            <li>При касании вторым и последующими пальцами (при остающемся первом):
                <br>происходит событие pointerdown со свойством <code>isPrimary=false</code> и уникальным
                <code>pointerId</code> для каждого касания.
            </li>
        </ul>
    </div>
    <div class="topic" id="pointercancel">
        <h3>Событие: pointercancel</h3>
        <p>Событие <code>pointercancel</code> происходит, когда браузер решает обработать самостоятельно текущие
            манипуляции с объектом. Для того, чтобы избежать этого, надо:</p>
        <ol>
            <li>Предотвратить запуск встроенного drag’n’drop
                <ul>
                    <li>Мы можем сделать это, задав <code>ball.ondragstart = () => false</code>, как описано в статье
                        Drag'n'Drop с событиями мыши.</li>
                    <li>Это работает для событий мыши. </li>
                </ul>
            </li>
            <li>Для устройств с сенсорным экраном существуют другие действия браузера, связанные с касаниями, кроме
                drag’n’drop. Чтобы с ними не возникало проблем:
                <ul>
                    <li>Мы можем предотвратить их, добавив в CSS свойство <code>#ball { touch-action: none }</code>.
                    </li>
                    <li>Затем наш код начнёт корректно работать на устройствах с сенсорным экраном </li>
                </ul>
            </li>
        </ol>
    </div>
    <div class="topic" id="catch">
        <h3>Захват указателя</h3>
        <p>Захват указателя – особая возможность событий указателя. Суть:</p>
        <ul>
            <li>elem.setPointerCapture(pointerId) – привязывает события с данным pointerId к elem. После такого вызова
                все события указателя с таким pointerId будут иметь elem в качестве целевого элемента (как будто
                произошли над elem), вне зависимости от того, где в документе они произошли.</li>
        </ul>
        <p>Другими словами, elem.setPointerCapture(pointerId) меняет target всех дальнейших событий с данным pointerId
            на elem.

            Эта привязка отменяется:</p>
        <ul>
            <li>автоматически, при возникновении события pointerup или pointercancel,</li>
            <li>автоматически, если elem удаляется из документа,</li>
            <li>при вызове elem.releasePointerCapture(pointerId). </li>
        </ul>
        <p>Пример:</p>
        <pre><code class="language-js">
thumb.onpointerdown = function(event) {
  // перенацелить все события указателя (до pointerup) на thumb
  thumb.setPointerCapture(event.pointerId);
  // начать отслеживание перемещения указателя
  thumb.onpointermove = function(event) {
    // перемещение слайдера: отслеживание thumb, т.к все события указателя перенацелены на него
    let newLeft = event.clientX - slider.getBoundingClientRect().left;
    thumb.style.left = newLeft + 'px';
  };
  // если сработало событие pointerup, завершить отслеживание перемещения указателя
  thumb.onpointerup = function(event) {
    thumb.onpointermove = null;
    thumb.onpointerup = null;
    // ...при необходимости также обработайте "конец перемещения"
  };
};
// примечание: нет необходимости вызывать thumb.releasePointerCapture,
// это происходит автоматически при pointerup    
</code></pre>
        <p>Таким образом, мы имеем два бонуса:</p>
        <ol>
            <li>Код становится чище, поскольку нам больше не нужно добавлять/удалять обработчики для всего документа.
                Удаление привязки происходит автоматически.</li>
            <li>Если в документе есть какие-то другие обработчики pointermove, то они не будут нечаянно вызваны, пока
                пользователь находится в процессе перетаскивания слайдера. </li>
        </ol>
        <h4>События при захвате указателя</h4>
        <ul>
            <li>gotpointercapture срабатывает, когда элемент использует setPointerCapture для включения захвата.</li>
            <li>lostpointercapture срабатывает при освобождении от захвата: явно с помощью releasePointerCapture или
                автоматически, когда происходит событие pointerup/pointercancel. </li>
        </ul>
    </div>
    <div class="topic" id="total">
        <h3>Итого</h3>
        <p>События указателя позволяют работать с устройствами без мыши, но с указателями касанием и мультитачем.</p>
        <p>События указателя расширяют события мыши, можно изменить mouse... на pointer... без переделки другого кода.
        </p>
        <p>Запретить браузеру самому обрабатывать события <code>touch-action: none</code> в CSS для элементов с которыми
            работаем.</p>
        <p>Доп возможности указателей:</p>
        <ul>
            <li>Поддержка мультитач с помощью pointerId и isPrimary.</li>
            <li>Особые свойства для определённых устройств, такие как pressure, width/height и другие.</li>
            <li>Захват указателя: мы можем перенаправить все события указателя на определённый элемент до наступления
                события pointerup/pointercancel. </li>
        </ul>
    </div>

</body>

</html>
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Куки, document.cookie</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script defer src="../scripts.js"></script>
</head>

<body>
    <div class="contents">
        <h2><a href="#cook">Куки, document.cookie</a></h2>
        <ul>
            <li><a href="#read">Чтение из document.cookie</a></li>
            <li><a href="#write">Запись в document.cookie</a></li>
            <li><a href="#path">path</a></li>
            <li><a href="#domain">domain</a></li>
            <li><a href="#expires">expires, max-age</a></li>
            <li><a href="#secure">secure</a></li>
            <li><a href="#samesite">samesite</a></li>
            <li><a href="#httpOnly">httpOnly</a></li>
            <li><a href="#appendix1">Приложение: Функции для работы с куки</a></li>
            <li><a href="#appendix2">Приложение: Сторонние куки</a></li>
            <li><a href="#GDPR">Приложение: GDPR</a></li>
            <li><a href="#total">Итого</a></li>
        </ul>
    </div>
    <div class="topic" id="cook">
        <h2><a href="https://learn.javascript.ru/cookie">Куки, document.cookie</a></h2>
        <p>Куки это небольшие строки данных которые храняться в браузере, длинной не более 4 кб. Являются частью
            HTTP-протокола определенного в стандарте.</p>
        <p>Устаналиваются сервером при помощи заголовка <code>Set-Cookie</code>. Потом браузер будет автоматически
            сообщать серверу какие у него куки заголовком <code>Cookie</code>.</p>
        <p>Наиболее распорстранённый сценарий это аунтефикация, в том числе и незаметная для пользователя:</p>
        <ol>
            <li>При входе на сайт сервер отсылает в ответ HTTP-заголовок Set-Cookie для того, чтобы установить куки со
                специальным уникальным идентификатором сессии («session identifier»).</li>
            <li>Во время следующего запроса к этому же домену браузер посылает на сервер HTTP-заголовок Cookie.</li>
            <li>Таким образом, сервер понимает, кто сделал запрос. </li>
        </ol>
        <p>Из скрипта на странице есть возможность получить доступ к свойству <code>document.cookie</code>.</p>
    </div>
    <div class="topic" id="read">
        <h3>Чтение из document.cookie</h3>
        <p>Чтобы прочитать куки сервера надо вызвать: <input type="button" value="Тест кук"
                onclick="alert( document.cookie );"></p>
        <pre><code class="language-js">alert( document.cookie ); // cookie1=value1; cookie2=value2;...</code></pre>
        <p>Естественно с локального документа не покажет ничего. Потому что ничего не установлено изначально.</p>
    </div>
    <div class="topic" id="write">
        <h3>Запись в document.cookie</h3>
        <p><code>document.cookie</code> - это ассессор, доступ к нему обрабатывается особым образом, свойство не
            обнуляется, а обновляется. Например:</p>
        <input type="button" value="Tест добавления кук" onclick="document.cookie = 'user=John'; // обновляем только куки с именем 'user'
alert(document.cookie); // показываем все куки">
        <pre><code class="language-js">
document.cookie = "user=John"; // обновляем только куки с именем 'user'
alert(document.cookie); // показываем все куки                
            </code></pre>
        <p>Добавить куки можно только при просмотре в локальном сервере, открытый с диска документ не позволяет
            установить куки. Соотвественно если какие-то куки были до этого, они перезаписаны не будут, а произойдёт
            добавление кук.</p>
        <p>Технически данные могут быть любыми, но лучше использовать ф-цию <code>encodeURIComponent</code> для
            правильной установки кук:</p>
        <pre><code class="language-js">
// специальные символы (пробелы), требуется кодирование
let name = "my name";
let value = "John Smith"

// кодирует в my%20name=John%20Smith
document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value);

alert(document.cookie); // ...; my%20name=John%20Smith                
            </code></pre>
        <p>В <a href="#appendix1">топике ниже</a> автор даёт нормальные ф-ции для работы с куками.</p>
        <blockquote>
            <h4>Ограничения</h4>
            <ul>
                <li>После encodeURIComponent пара name=value не должна занимать более 4Кб. Таким образом, мы не можем
                    хранить в куки большие данные.</li>
                <li>Общее количество куки на один домен ограничивается примерно 20+. Точное ограничение зависит от
                    конкретного браузера. </li>
            </ul>
        </blockquote>
    </div>
    <div class="topic" id="path">
        <h3>path</h3>
        <p><code>path=/somepath</code></p>
        <p>Значения будут доступны на путях <code>somepath</code>. То есть на страницах <code>/somepath</code>,
            <code>/somepath/someelse</code>, но не на путях <code>/difpath</code>.
        </p>
        <p>Установка <code>path=/</code> обеспечивает доступность кук по всему сайту.</p>
    </div>
    <div class="topic" id="domain">
        <h3>domain</h3>
        <p><code>domain=site.com</code> - подразумевается, что установить куки для другого домена не удасться. Настройка
            нужна для того, чтобы кука была доступа и с site.com и с forum.site.com. Работает так:</p>
        <pre><code class="language-js">
// находясь на странице site.com
// сделаем куки доступным для всех поддоменов *.site.com:
document.cookie = "user=John; domain=site.com"

// позже

// на forum.site.com
alert(document.cookie); // есть куки user=John                
            </code></pre>
        <p>Tак же работает запись .site.com по историческим причинам, для старых браузеров обозначает поддомены.</p>
    </div>

</body>

</html>
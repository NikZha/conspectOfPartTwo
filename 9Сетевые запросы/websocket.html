<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script defer src="../scripts.js"></script>
</head>

<body>
    <div class="contents">
        <h2><a href="#websockets">WebSocket</a></h2>
        <ul>
            <li><a href="#simple">Простой пример</a></li>
            <li><a href="#open">Простой пример</a></li>
            <li><a href="#send">Передача данных</a></li>
            <li><a href="#reduce">Ограничение скорости</a></li>
            <li><a href="#close">Закрытие подключения</a></li>
            <li><a href="#state">Состояние соединения</a></li>
            <li><a href="#expmlechat">Пример чата</a></li>
            <li><a href="#total">Итого</a></li>
        </ul>
    </div>

    <div class="topic" id="websockets">
        <h2><a href="https://learn.javascript.ru/websocket">WebSocket</a></h2>
        <p>Постоянное соединение между браузером и сервером используется для сервисом которые используют обмен
            реалтаймовыми данными.</p>
    </div>
    <div class="topic" id="simple">
        <h3>Простой пример</h3>
        <p>Создание объекта соединения:</p>
        <pre><code class="lang">
let socket = new WebSocket("ws://javascript.info");            
        </code></pre>
        <p>Где <code>ws</code> - это не шифрованный протокол, а <code>wss</code> - шифрованный протокол, который более
            предпочителен для использования.
        </p>
        <p>После создания объекта у него есть 4 события которые необходимо обрабатывать:</p>
        <ol>
            <li><code>open</code> – соединение установлено,</li>
            <li><code>message</code> – получены данные,</li>
            <li><code>error</code> – ошибка,</li>
            <li><code>close</code> – соединение закрыто. </li>
        </ol>
        <p>Для отправки данных есть метод: <code>obj.send(data)</code>. Например:</p>
        <pre><input type="button" value="Тест веб-сокета" onclick="expl1()"><code class="language-js">
let socket = new WebSocket("wss://javascript.info/article/websocket/demo/hello");

socket.onopen = function(e) {
  alert("[open] Соединение установлено");
  alert("Отправляем данные на сервер");
  socket.send("Меня зовут Джон");
};

socket.onmessage = function(event) {
  alert(`[message] Данные получены с сервера: ${event.data}`);
};

socket.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Соединение закрыто чисто, код=${event.code} причина=${event.reason}`);
  } else {
    // например, сервер убил процесс или сеть недоступна
    // обычно в этом случае event.code 1006
    alert('[close] Соединение прервано');
  }
};

socket.onerror = function(error) {
  alert(`[error]`);
};            
        </code></pre>
        <script>
            function expl1(params) {
let socket = new WebSocket("wss://javascript.info/article/websocket/demo/hello");

socket.onopen = function(e) {
  alert("[open] Соединение установлено");
  alert("Отправляем данные на сервер");
  socket.send("Меня зовут Джон");
};

socket.onmessage = function(event) {
  alert(`[message] Данные получены с сервера: ${event.data}`);
};

socket.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Соединение закрыто чисто, код=${event.code} причина=${event.reason}`);
  } else {
    // например, сервер убил процесс или сеть недоступна
    // обычно в этом случае event.code 1006
    alert('[close] Соединение прервано');
  }
};

socket.onerror = function(error) {
  alert(`[error]`);
};                
            }
        </script>
        <p>За ответ на этот запрос отвечает <a href="https://learn.javascript.ru/article/websocket/demo/server.js">server.js</a>.</p>
    </div>



</body>

</html>
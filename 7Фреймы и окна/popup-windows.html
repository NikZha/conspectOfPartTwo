<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Открытие окон и методы window</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script defer src="../scripts.js"></script>
</head>

<body>
    <div class="contents">
        <h2><a href="#open">Открытие окон и методы window</a></h2>
        <ul>
            <li><a href="#block">Блокировка попапов</a></li>
            <li><a href="#full">Полный синтаксис window.open</a></li>
            <li><a href="#example">Пример: минималистичное окно</a></li>
            <li><a href="#accsess">Доступ к попапу из основного окна</a></li>
            <li><a href="#acc">Доступ к открывшему окну из попапа</a></li>
            <li><a href="#close">Закрытие попапа</a></li>
            <li><a href="#scroll">Прокрутка и изменение размеров</a></li>
            <li><a href="#scrollwondow">Прокрутка окна</a></li>
            <li><a href="#lost">Установка и потеря фокуса</a></li>
            <li><a href="#total">Итого</a></li>
        </ul>
    </div>
    <div class="topic" id="open">
        <h2><a href="https://learn.javascript.ru/popup-windows">Открытие окон и методы window</a></h2>
        <p>Открытие отдельного окна:</p>
        <pre><input type="button" value="Открытие окна" onclick="window.open('https://javascript.info/')">
            <code class="language-js">
window.open('https://javascript.info/')            
        </code></pre>
        <p>Но в текущий момент это околоанахронизм, поскольку js может грузить окна fetch в том числе и в отдельном div:
        </p>
        <script>
            async function expl1(params) {
                let respons = await fetch('../README.HTML');
                testdiv.innerHTML = await respons.text()
            }
        </script>
        <pre><code class="language-js">
            async function expl1(params) {
                let respons = await fetch('../README.HTML');
                testdiv.innerHTML = await respons.text()
            }            
        </code></pre>
        <div id="testdiv" onclick="expl1()">Кликни на меня</div>
        <p>Однако для ряда задач pop-up может использоваться, поскольку:</p>
        <ol>
            <li>Попап – это отдельное окно со своим JavaScript-окружением. Так что открытие попапа со стороннего, не
                доверенного сайта вполне безопасно</li>
            <li>Открыть попап очень просто.</li>
            <li>Попап может производить навигацию (менять URL) и отсылать сообщения в основное окно.</li>
        </ol>
    </div>
    <div class="topic" id="block">
        <h3>Блокировка попапов</h3>
        <p>Поскольку эффективные менеджеры засрали вообще все, то по крайней мере ff крайне неохотно открывает любые
            попапы, но</p>
        <pre><code class="language-js">
// попап заблокирован
window.open('https://javascript.info');

// попап будет показан
button.onclick = () => {
  window.open('https://javascript.info');
};            
        </code></pre>
        <p>Хотя кто мешает повесить подобное на просто клики по документы, на
            mousemove-mouseover-mouseout-mouseenter-mouseleave и тд.</p>
    </div>
    <div class="topic" id="full">
        <h3>Полный синтаксис window.open</h3>
        <pre><code class="language-js">
window.open(url, name, params)        
    </code></pre>
        <p>где:</p>
        <ul>
            <li><strong>url</strong>
                <br>URL для загрузки в новом окне.
            </li>
            <li><strong>name</strong>
                <br>Имя нового окна. У каждого окна есть свойство window.name, в котором можно задавать, какое окно
                использовать для попапа. Таким образом, если уже существует окно с заданным именем – указанный в
                параметрах URL откроется в нем, в противном случае откроется новое окно.
            </li>
            <li><strong>params</strong>
                <br>Строка параметров для нового окна. Содержит настройки, разделённые запятыми. Важно помнить, что в
                данной строке не должно быть пробелов. Например <code>width=200,height=100</code>.
            </li>

        </ul>
        <p><code>params</code> задаются String где:</p>
        <ul>
            <li>Позиция окна:</li>
            <ul>
                <li><code>left/top (числа)</code> – координаты верхнего левого угла нового окна на экране. Существует
                    ограничение: новое окно не может быть позиционировано вне видимой области экрана.</li>
                <li><code>width/height (числа)</code> – ширина и высота нового окна. Существуют ограничения на
                    минимальную высоту и ширину, которые делают невозможным создание невидимого окна.</li>
            </ul>
            <li>Панели окна:</li>
            <ul>
                <li><code>menubar (yes/no)</code> – позволяет отобразить или скрыть меню браузера в новом окне.</li>
                <li><code>toolbar (yes/no)</code> – позволяет отобразить или скрыть панель навигации браузера (кнопки
                    вперёд, назад, перезагрузки страницы) нового окна.</li>
                <li><code>location (yes/no)</code> – позволяет отобразить или скрыть адресную строку нового окна.
                    Firefox и IE не позволяют скрывать эту панель по умолчанию.</li>
                <li><code>status (yes/no)</code> – позволяет отобразить или скрыть строку состояния. Как и с адресной
                    строкой, большинство браузеров будут принудительно показывать её.</li>
                <li><code>resizable (yes/no)</code> – позволяет отключить возможность изменения размера нового окна. Не
                    рекомендуется.</li>
                <li><code>scrollbars (yes/no)</code> – позволяет отключить полосы прокрутки для нового окна. Не
                    рекомендуется. </li>
            </ul>
        </ul>
    </div>
    <div class="topic" id="example">
        <h3><a href="https://learn.javascript.ru/popup-windows#primer-minimalistichnoe-okno">Пример: минималистичное
                окно</a></h3>
        <p>В топике показаны два примера, один от балды с размерами:</p>
        <pre><code class="language-js">
let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=0,height=0,left=-1000,top=-1000`;

open('/', 'test', params);        
    </code></pre>
        <p>Второй с более адекватными размерами:</p>
        <pre><code class="language-js">
let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,
width=600,height=300,left=100,top=100`;

open('/', 'test', params);        
    </code></pre>
        <p>Но по сути в обоих примерах большая часть настроек не работает, потому что эффективным менеджеры на
            побегушках у буржуёв обосрали все.</p>
        <p>Правила для опущенных параметров:</p>
        <ul>
            <li>Если третий аргумент при вызове open отсутствует или он пустой, будут использованы настройки окна по
                умолчанию.</li>
            <li>Если строка параметров передана, но некоторые параметры yes/no пропущены, то считается, что указано no,
                так что соответствующие возможности будут отключены, если на это нет ограничений со стороны браузера.
                Поэтому при задании параметров убедитесь, что вы явно указали все необходимые yes.</li>
            <li>Если координаты left/top не заданы, браузер попытается открыть новое окно рядом с предыдущим открытым
                окном.</li>
            <li>Если не заданы размеры окна width/height, браузер откроет новое окно с теми же размерами, что и
                предыдущее открытое окно. </li>
        </ul>
    </div>
    <div class="topic" id="accsess">
        <h3>Доступ к попапу из основного окна</h3>
        <p>Вся бы эта возня не стоила бы и копейки, если бы между окнами нельзя было бы осуществлять общение. И его так
            осуществлять можно:</p>
        <pre><code class="lang">
let newWin = window.open('about:blank', 'hello', 'width=200,height=200');

newWin.document.write('Hello, world!');            
        </code></pre>
        <input type="button" value="Hello World" onclick="let newWin = window.open('about:blank', 'hello', 'width=200,height=200');

newWin.document.write('Hello, world!');">
        <p>А так же можно модифицировать содержимое:</p>
        <pre><input type="button" value="Модификация содержимого" onclick="expl2()">
            <code class="lang">
let newWindow = open('/', 'example', 'width=300,height=300')
newWindow.focus();

alert(newWindow.location.href); // (*) about:blank, загрузка ещё не началась

newWindow.onload = function() {
  let html = `<div style="font-size:30px">Добро пожаловать!</div>`;
  newWindow.document.body.insertAdjacentHTML('afterbegin', html);
};    
</code></pre>
        <script>
            function expl2(params) {
                let newWindow = open('/', 'example', 'width=300,height=300')
                newWindow.focus();

                alert(newWindow.location.href); // (*) about:blank, загрузка ещё не началась

                newWindow.onload = function () {
                    let html = `<div style="font-size:30px">Добро пожаловать!</div>`;
                    newWindow.document.body.insertAdjacentHTML('afterbegin', html);
                };
            }
        </script>
        <p>Но надо сказать это сработает только на том же домене, что и расположение скрипта открывающего окно, открыть
            левый сайт и добавить туда что-либо браузер не даёт. Как и всегда все инициативы извращены и обосраны
            буржуазным строем.</p>
    </div>
    <div class="topic" id="acc">
        <h3>Доступ к открывшему окну из попапа</h3>
        <p>Pop-up окно может обратиться к своему родителю при помощи <code>window.opener</code>. Для всех остальных окон
            там <code>null</code>.</p>
        <pre><input type="button" value="Тест доступа" onclick="expl3()">
                <code class="language-js">
let newWin = window.open("about:blank", "hello", "width=200,height=200");

newWin.document.write(
  "&lt;script>window.opener.document.body.innerHTML = 'Тест'&lt;\/script>"
);                
            </code></pre>
        <script>
            function expl3(params) {
                let newWin = window.open("about:blank", "hello", "width=200,height=200");

                newWin.document.write(
                    "<script>window.opener.document.body.innerHTML = 'Тест'<\/script>"
                )
            }
        </script>
    </div>
    <div class="topic" id="close">
        <h3>Закрытие попапа</h3>
        <p>Закрытие окна <code>win.close()</code>.</p>
        <p>Чтобы проверить закрыто ли окно <code>win.closed</code>.</p>
        <pre><input type="button" value="Затестить закрытие" onclick="expl4()">
            <code class="language-js">
let newWindow = open('/', 'example', 'width=300,height=300');

newWindow.onload = function() {
  newWindow.close();
  alert(newWindow.closed); // true
};        
    </code></pre>
        <script>
            function expl4(params) {
                let newWindow = open('/', 'example', 'width=300,height=300');

                newWindow.onload = function () {
                    newWindow.close();
                    alert(newWindow.closed); // true
                };
            }
        </script>
    </div>
    <div class="topic" id="scroll">
        <h3>Прокрутка и изменение размеров</h3>
        <p>Методы для передвижения и изменения размеров окна:</p>
        <ul>
            <li><code>win.moveBy(x,y)</code>
                <br>Переместить окно относительно текущей позиции на x пикселей вправо и y пикселей вниз. Допустимы
                отрицательные значения (для перемещения окна влево и вверх).
            </li>
            <li><code>win.moveTo(x,y)</code>
                <br>Переместить окно на координаты экрана (x,y).
            </li>
            <li><code>win.resizeBy(width,height)</code>
                <br>Изменить размер окна на указанные значения width/height относительно текущего размера. Допустимы
                отрицательные значения.
            </li>
            <li><code>win.resizeTo(width,height) </code>
                <br>Изменить размер окна до указанных значений.
            </li>
        </ul>
        <p>Также существует событие <code>window.onresize</code>.</p>
        <blockquote>
            <h4>Только попапы</h4>
            Чтобы предотвратить возможные злоупотребления, браузер обычно блокирует эти методы. Они гарантированно
            работают только с попапами, которые мы открыли сами и у которых нет дополнительных вкладок.
        </blockquote>
        <blockquote>
            <h4>Нельзя свернуть/развернуть окно</h4>
            Методами JavaScript нельзя свернуть или развернуть («максимизировать») окно на весь экран. За это отвечают
            функции уровня операционной системы, и они скрыты от фронтенд-разработчиков.

            <br>Методы перемещения и изменения размера окна не работают для свернутых и развёрнутых на весь экран окон
        </blockquote>
    </div>
    <div class="topic" id="lost">
        <h3>Установка и потеря фокуса</h3>
        <p><code>window.focus()</code> - устрановить фокус окна.</p>
        <p><code>window.blur()</code> - убрать из фокуса.</p>
        <p>Но в современных браузерах такое может и не сработать из-за злоупотреблений вида:</p>
        <pre><code class="language-js">
window.onblur = () => window.focus();        
    </code></pre>
        <p>Однако в ряде методов эти методы могут быть полезны:</p>
        <ul>
            <li>При открытии нового окна хорошим тоном будет взять его в фокус чтобы пользователь его заметил.</li>
            <li>Так же методы <code>window.onfocus/onblur</code> можно использовать для запуска анимаций в окне.</li>
        </ul>
    </div>
    <div class="topic" id="total">
        <h3>Итого</h3>
        <p>В современных реализиях всплывающие окна используются редко, можно загрузить в отдельный
            <code>&lt;div&gt;</code> при помощи <code>fetch</code> документ.
            Или использовать <code>&lt;iframe&gt;</code>.
        </p>
        <p>Лучше предупредить пользователя о том, что будет открыто новое окно:</p>
        <ul>

            <li>Новое окно можно открыть с помощью вызова open(url, name, params). Этот метод возвращает ссылку на это
                новое окно.</li>
            <li>По умолчанию браузеры блокируют вызовы open, выполненные не в результате действий пользователя. Обычно
                браузеры показывают предупреждение, так что пользователь всё-таки может разрешить вызов этого метода.
            </li>
            <li>Вместо попапа открывается вкладка, если в вызове open не указаны его размеры.</li>
            <li>У попапа есть доступ к породившему его окну через свойство window.opener.</li>
            <li>Если основное окно и попап имеют один домен и протокол, то они свободно могут читать и изменять друг
                друга. В противном случае, они могут только изменять положение друг друга и взаимодействовать с помощью
                сообщений.</li>

        </ul>
        <p>Чтобы закрыть окно, как и любое можно использовать на объекте метод <code>.close()</code>, если это дочернее
            окно то свойство <code>window.closed</code> будет <code>true</code>.</p>
        <ul>

            <li>Методы <code>focus()</code> и <code>blur()</code> позволяют установить или убрать фокус с попапа. Но
                работают не всегда.</li>
            <li>События <code>focus</code> и <code>blur</code> позволяют отследить получение и потерю фокуса новым
                окном. Но, пожалуйста, не забывайте, что окно может остаться видимым и после <code>blur</code>.</li>

        </ul>
    </div>

</body>

</html>
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Объекты URL</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script defer src="../scripts.js"></script>
</head>

<body>
    <div class="contents">
        <h2><a href="#url">Объекты URL</a></h2>
        <ul>
            <li><a href="#make">Создание URL</a></li>
            <li><a href="#search">SearchParams «?…»</a></li>
            <li><a href="#code">Кодирование</a></li>
        </ul>
    </div>
    <div class="topic" id="url">
        <h2><a href="https://learn.javascript.ru/url">Объекты URL</a></h2>
        <p>Встроенный класс для создания и парсинга <code>url</code>. Нет методов которые требовали бы этот объект,
            подходит <code>String</code>.</p>
    </div>
    <div class="topic" id="make">
        <h3>Создание URL</h3>
        <pre><code class="language-js">
new URL(url, [base])            
        </code></pre>
        <p>Где:</p>
        <ul>
            <li><code>url</code> – полный URL-адрес или только путь, если указан второй параметр,</li>
            <li><code>base</code> – необязательный «базовый» URL: если указан и аргумент url содержит только путь, то
                адрес будет создан относительно него (пример ниже). </li>
        </ul>
        <p>Пример создания:</p>
        <pre><input type="button" value="Создание url" onclick="expl1()"><code class="language-js">
let url1 = new URL('https://javascript.info/profile/admin');
let url2 = new URL('/profile/admin', 'https://javascript.info');

alert(url1.toString() == url2.toString()); // Получается одинаковая строка, объекты естественно будут разные        
        </code></pre>
        <script>
            function expl1() {
                let url1 = new URL('https://javascript.info/profile/admin');
                let url2 = new URL('/profile/admin', 'https://javascript.info');

                alert(url1.toString() == url2.toString());
            }
        </script>
        <p>Так же можно создать <code>url</code> из текущего и разложить его на составляющие:</p>
        <input type="button" value="Создать url и составляющие url" onclick="expl2()">
        <pre><code class="language-js">
let url = new URL('https://javascript.info/profile/admin');
let newUrl = new URL('tester', url);

alert(`URL = ${newUrl}`); // https://javascript.info/profile/tester
alert(`Protocol = ${newUrl.protocol}`)                
alert(`Host = ${newUrl.host}`)
alert(`pathname = ${newUrl.pathname}`)    
</code></pre>
        <script>
            function expl2() {
                let url = new URL('https://javascript.info/profile/admin');
                let newUrl = new URL('tester', url);

                alert(`URL = ${newUrl}`); // https://javascript.info/profile/tester
                alert(`Protocol = ${newUrl.protocol}`)
                alert(`Host = ${newUrl.host}`)
                alert(`pathname = ${newUrl.pathname}`)
                //И так далее
            }
        </script>
        <p>Структура URL:</p>
        <img src="href.jpeg" alt="">
        <p>Где:</p>
        <ul>
            <li><code>href</code> это полный URL-адрес, то же самое, что url.toString()</li>
            <li><code>protocol</code> – протокол, заканчивается символом двоеточия :</li>
            <li><code>search</code> строка параметров, начинается с вопросительного знака ?</li>
            <li><code>hash</code> начинается с символа #
                <br>также есть свойства user и password, если используется HTTP-аутентификация:
                <code>http://login:password@site.com</code> (не нарисованы сверху, так как редко используются).
            </li>
        </ul>
        <blockquote>
            <p>Большинство сетевых методов способны принимать объекты URL, так же пихать можно куда угодно -
                преобразуются
                <code>.toString()</code>
            </p>
        </blockquote>
    </div>
    <div class="topic" id="search">
        <h3>SearchParams «?…»</h3>
        <p>Есть возможность прописывать параметры запроса в поиске:</p>
        <ul>
            <li><code>append(name, value)</code> – добавить параметр по имени,</li>
            <li><code>delete(name)</code> – удалить параметр по имени,</li>
            <li><code>get(name)</code> – получить параметр по имени,</li>
            <li><code>getAll(name)</code> – получить все параметры с одинаковым именем name (такое возможно, например:
                ?user=John&user=Pete),</li>
            <li><code>has(name)</code> – проверить наличие параметра по имени,</li>
            <li><code>set(name, value)</code> – задать/заменить параметр,</li>
            <li><code>sort()</code> – отсортировать параметры по имени, используется редко,</li>
            <li>…и является перебираемым, аналогично <code>Map</code>. </li>
        </ul>
        <p>Например:</p>
        <pre><code class="language-js">
let url = new URL('https://google.com/search');
url.searchParams.set('q', 'test me!'); // добавим параметр, содержащий пробел и !

alert(url); // https://google.com/search?q=test+me%21

url.searchParams.set('tbs', 'qdr:y'); // параметр с двоеточием :

// параметры автоматически кодируются
alert(url); // https://google.com/search?query=test+me%21&tbs=qdr%3Ay

// перебрать параметры (в исходном виде)
for(let [name, value] of url.searchParams) {
  alert(`${name}=${value}`); // q=test me!, далее tbs=qdr:y
}            
        </code></pre>
    </div>
    <div class="topic" id="code">
        <h3>Кодирование</h3>
        <p><a href="https://datatracker.ietf.org/doc/html/rfc3986">Стандарт RFC3986</a> определяет список разрешёный
            символов в <code>url</code>. Запрещённые кодируются разрешёнными. Объект <code>URL</code> на лету
            перекодирует запрещённые символы в разрещённые. Например:</p>
        <script>
            function expl3() {
                let url = new URL('https://ru.wikipedia.org/wiki/Тест');

                url.searchParams.set('key', 'ъ');
                alert(url); //https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82?key=%D1%8A                    
            }
        </script>
        <input type="button" value="Тест кодирования" onclick="expl3()">
        <pre><code class="language-js">
let url = new URL('https://ru.wikipedia.org/wiki/Тест');

url.searchParams.set('key', 'ъ');
alert(url); //https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82?key=%D1%8A                   
            </code></pre>
        <div id="String">
            <h3>Кодирование в строках</h3>
            <p>Для кодирования и раскодирования строк используются специальные ф-ции:</p>
            <ul>
                <li>encodeURI – кодирует URL-адрес целиком.</li>
                <li>decodeURI – декодирует URL-адрес целиком.</li>
                <li>encodeURIComponent – кодирует компонент URL, например, параметр, хеш, имя пути и т.п.</li>
                <li>decodeURIComponent – декодирует компонент URL. </li>
            </ul>
            <p>Например:</p>
            <pre><code class="language-js">
let url = encodeURI('http://site.com/привет');

alert(url); // http://site.com/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82
let music = encodeURIComponent('Rock&Roll');

url = `https://google.com/search?q=${music}`;
alert(url); // https://google.com/search?q=Rock%26Roll
music = encodeURI('Rock&Roll');

url = `https://google.com/search?q=${music}`;
alert(url); // https://google.com/search?q=Rock&Roll                    
                </code></pre>
            <p> Но не всё гладко:</p>
            <pre><code class="language-js">
// допустимый URL-адрес IPv6
let url = 'http://[2607:f8b0:4005:802::1007]/';

alert(encodeURI(url)); // http://%5B2607:f8b0:4005:802::1007%5D/
alert(new URL(url)); // http://[2607:f8b0:4005:802::1007]/                    
                </code></pre>
        </div>
    </div>
</body>

</html>
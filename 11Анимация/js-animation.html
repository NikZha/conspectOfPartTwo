<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript-анимации</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script defer src="../scripts.js"></script>
</head>

<body>
    <div class="contents">
        <h2><a href="#jsanima">JavaScript-анимации</a></h2>
        <ul>
            <li><a href="#use">Использование setInterval</a></li>
            <li><a href="#usereq">Использование requestAnimationFrame</a></li>
            <li><a href="#struct">Структура анимации</a></li>
            <li><a href="#func">Функции расчёта времени</a></li>
            <li><a href="#reverse">Реверсивные функции: ease*</a></li>
            <li><a href="#draw">Более интересная функция «draw»</a></li>
            <li><a href="#total">Итого</a></li>
            <li><a href="#tasks">Задачи</a></li>
        </ul>
    </div>

    <div class="topic" id="jsanima">
        <h2><a href="https://learn.javascript.ru/js-animation">JavaScript-анимации</a></h2>
        <p>С помощью JavaScript-анимаций можно делать вещи, которые нельзя реализовать на CSS-анимациях.</p>
    </div>
    <div class="topic" id="use">
        <h3>Использование setInterval</h3>
        <p>Идея в том, чтобы менять например <code>obj.style.left</code> с каким-нибудь интревалом перемещая объект:</p>
        <style>
            #train {
                position: relative;
                cursor: pointer;
            }
        </style>
        <img src="train.gif" alt="" id="train" onclick="trainMove()">
        <script>
            function trainMove() {
                let start = Date.now(); // запомнить время начала

                let timer = setInterval(function () {
                    // сколько времени прошло с начала анимации?
                    let timePassed = Date.now() - start;

                    if (timePassed >= 2000) {
                        clearInterval(timer); // закончить анимацию через 2 секунды
                        return;
                    }

                    // отрисовать анимацию на момент timePassed, прошедший с начала анимации
                    draw(timePassed);

                }, 20);

                // в то время как timePassed идёт от 0 до 2000
                // left изменяет значение от 0px до 400px
                function draw(timePassed) {
                    train.style.left = timePassed / 5 + 'px';
                }
            }
        </script>
        <pre><code class="language-js">
            function trainMove() {
                let start = Date.now(); // запомнить время начала

                let timer = setInterval(function () {
                    // сколько времени прошло с начала анимации?
                    let timePassed = Date.now() - start;

                    if (timePassed >= 2000) {
                        clearInterval(timer); // закончить анимацию через 2 секунды
                        return;
                    }

                    // отрисовать анимацию на момент timePassed, прошедший с начала анимации
                    draw(timePassed);

                }, 20);

                // в то время как timePassed идёт от 0 до 2000
                // left изменяет значение от 0px до 400px
                function draw(timePassed) {
                    train.style.left = timePassed / 5 + 'px';
                }
            }            
        </code></pre>
        <p>Данная функиция находится на свойстве онклик рисунка, что с соответствующей настройкой css позволяет
            перемещать объект.</p>
    </div>
    <div class="topic" id="usereq">
        <h3>Использование requestAnimationFrame</h3>
        <p>Сама функиция используется для запуска анимации с целью экономии ресурсов. Синтаксис такой:</p>
        <pre><code class="language-js">
let requestId = requestAnimationFrame(callback)            
        </code></pre>
        <p>Для отмены анимации:</p>
        <pre><code class="language-js">
cancelAnimationFrame(requestId)            
        </code></pre>
        <p>Как я понимаю, в <code>callback</code> передаётся время с момент запуска страницы первым аргументом. Немножко
            говнокода из урока для прояснения ситуации:</p>
        <pre><input type="button" value="Тест периода запуска" onclick="howManyTimes()"><code class="language-js">
&lt;script>
  let prev = performance.now();
  let times = 0;

  requestAnimationFrame(function measure(time) {
    document.body.insertAdjacentHTML("beforeEnd", Math.floor(time - prev) + " ");
    prev = time;

    if (times++ < 10) requestAnimationFrame(measure);
  })
&lt;/script>                
            </code></pre>
        <p id="expl"></p>
        <script>
            function howManyTimes() {
                let prev = performance.now();
                let times = 0;

                requestAnimationFrame(function measure(time) {
                    expl.insertAdjacentHTML("beforeEnd", Math.floor(time - prev) + " ");
                    prev = time;

                    if (times++ < 10) requestAnimationFrame(measure);
                })
            }
        </script>
        <p>Таким образом видно, что запускается функиция <code>measure</code> раз в 10-20 ms.</p>
    </div>
    <div class="topic" id="endfornowthisfile">
        <h2>Конспектирование раздела окончено</h2>
        <p>В связи с тем, что это ну слишком далеко от текущей деятельности.</p>
    </div>









</body>

</html>